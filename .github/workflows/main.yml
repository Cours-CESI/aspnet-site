name: Deploy to server via SSH

on:
  push:
    branches:
      - main  # Exécuter le workflow à chaque fois qu'il y a un push sur la branche main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    # Étape 1: Vérifier le dépôt
    - name: Checkout repository
      uses: actions/checkout@v3
      
    - name: LS
      run: ls
    - name: PWD
      run: pwd

    # Étape 2: Installer sshpass
    - name: Install sshpass
      run: sudo apt-get update && sudo apt-get install -y sshpass

    # Étape 3: Copier les fichiers avec sshpass et scp
    - name: Copy files via SCP
      run: |
        sshpass -p "aspnet-site" scp -r aspnet-site@skyserver.fr:/home/aspnet-site/aspnet-site *

    # Étape 4: Exécuter des commandes via sshpass et SSH
    - name: Run SSH command
      run: |
        sshpass -p 'aspnet-site' ssh aspnet-site@skyserver.fr 'docker-compose restart --force-recreate'
